# ğŸ”§ AdminåŠŸèƒ½å®ŒæˆæŠ¥å‘Š

**å®Œæˆæ—¶é—´**: 2025-10-28  
**çŠ¶æ€**: âœ… æ‰€æœ‰åŠŸèƒ½å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡

---

## ğŸ“‹ ä»»åŠ¡æ¸…å•

### âœ… å·²å®Œæˆä»»åŠ¡

1. âœ… **ç§»é™¤SDæ¨¡å‹** - ä»cloudflare_client_simple.pyåˆ é™¤Stable Diffusion XLæ¨¡å‹
2. âœ… **æ•°æ®åº“æ¨¡å‹æ›´æ–°** - Userè¡¨æ·»åŠ is_adminå’Œroleå­—æ®µï¼Œåˆ›å»ºUserLimitè¡¨
3. âœ… **Adminæƒé™éªŒè¯** - åˆ›å»ºmiddleware.pyå®ç°adminæƒé™ä¸­é—´ä»¶
4. âœ… **Adminåç«¯è·¯ç”±** - åˆ›å»ºadmin_router.pyå®ç°æ‰€æœ‰ç®¡ç†åŠŸèƒ½
5. âœ… **Adminå‰ç«¯é¢æ¿** - åˆ›å»ºAdminPanel.tsxå®ç°å®Œæ•´ç®¡ç†ç•Œé¢
6. âœ… **æ•°æ®åº“è¿ç§»** - æˆåŠŸè¿ç§»ç°æœ‰æ•°æ®åº“æ·»åŠ æ–°å­—æ®µ
7. âœ… **Adminè´¦æˆ·åˆ›å»º** - åˆ›å»ºé»˜è®¤adminè´¦æˆ·

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æ¨¡å‹ç²¾ç®€ (5ä¸ªå¯ç”¨æ¨¡å‹)

#### ğŸ’¬ æ–‡æœ¬ç”Ÿæˆ (4ä¸ª)
- **Llama 3.1 8B Instruct** - Meta - å¿«é€Ÿå¯é ï¼Œå¤šè¯­è¨€å¯¹è¯
- **Llama 3 8B Instruct** - Meta - ç¨³å®šç‰ˆæœ¬ï¼Œé€šç”¨ä½¿ç”¨
- **Llama 2 7B Chat FP16** - Meta - ç¨³å®šï¼Œå¹¿æ³›å…¼å®¹
- **Mistral 7B Instruct** - MistralAI - é«˜è´¨é‡ï¼Œå¤æ‚ä»»åŠ¡

#### ğŸ¨ å›¾åƒç”Ÿæˆ (1ä¸ª)
- **FLUX.1 Schnell** - Black Forest Labs - 12Bå‚æ•°ï¼Œè¶…å¿«é€Ÿ(4æ­¥)

**å·²ç§»é™¤**:
- âŒ Stable Diffusion XL Base 1.0
- âŒ Stable Diffusion XL Lightning

---

### 2. AdminåŠŸèƒ½ç‰¹æ€§

#### ğŸ” æƒé™ç³»ç»Ÿ
- **Adminè§’è‰²**: ç”¨æˆ·è¡¨æ–°å¢`is_admin`å’Œ`role`å­—æ®µ
- **æƒé™éªŒè¯**: ä¸­é—´ä»¶`require_admin`ç¡®ä¿åªæœ‰adminå¯è®¿é—®ç®¡ç†åŠŸèƒ½
- **å‰ç«¯æ§åˆ¶**: åªæœ‰adminç”¨æˆ·èƒ½çœ‹åˆ°"ğŸ”§ Admin"æ ‡ç­¾é¡µ

#### ğŸ“Š å¹³å°ç›‘æ§
- **ç”¨æˆ·ç»Ÿè®¡**:
  - æ€»ç”¨æˆ·æ•°
  - æ´»è·ƒç”¨æˆ·æ•°
  - Adminç”¨æˆ·æ•°
  
- **ä½¿ç”¨ç»Ÿè®¡**:
  - æ€»è¯·æ±‚æ•°
  - æ€»tokenæ•°
  - ä»Šæ—¥è¯·æ±‚æ•°
  - ä»Šæ—¥tokenæ•°
  - Top 10 çƒ­é—¨æ¨¡å‹

#### ğŸ‘¥ ç”¨æˆ·ç®¡ç†
- **æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·**:
  - ç”¨æˆ·ä¿¡æ¯ï¼ˆç”¨æˆ·åã€é‚®ç®±ã€è§’è‰²ã€çŠ¶æ€ï¼‰
  - å®æ—¶ä½¿ç”¨ç»Ÿè®¡ï¼ˆæ€»è¯·æ±‚ã€æ€»tokensã€ä»Šæ—¥ä½¿ç”¨ï¼‰
  - é…é¢é™åˆ¶çŠ¶æ€
  
- **ç”¨æˆ·æ§åˆ¶**:
  - âœ… å¯ç”¨/ç¦ç”¨ç”¨æˆ·è´¦æˆ·
  - ğŸ—‘ï¸ åˆ é™¤ç”¨æˆ·ï¼ˆä¸èƒ½åˆ é™¤adminï¼‰
  - ğŸ”§ è®¾ç½®ç”¨æˆ·é…é¢é™åˆ¶
  
#### âš™ï¸ é…é¢ç®¡ç†
- **å¯é…ç½®é™åˆ¶**:
  - `max_requests_per_day`: æ¯æ—¥æœ€å¤§è¯·æ±‚æ•°
  - `max_tokens_per_day`: æ¯æ—¥æœ€å¤§tokenæ•°
  - `max_tokens_per_month`: æ¯æœˆæœ€å¤§tokenæ•°
  - `is_limited`: æ˜¯å¦å¯ç”¨é™åˆ¶
  
- **ç‰¹æ®Šå€¼**:
  - `0` = æ— é™åˆ¶
  - Adminç”¨æˆ·é»˜è®¤æ— é™åˆ¶

---

## ğŸ—„ï¸ æ•°æ®åº“æ¶æ„

### Userè¡¨ (æ›´æ–°)
```sql
CREATE TABLE users (
    id TEXT PRIMARY KEY,
    username TEXT UNIQUE NOT NULL,
    email TEXT UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    api_key TEXT UNIQUE NOT NULL,
    is_active BOOLEAN DEFAULT 1,
    is_admin BOOLEAN DEFAULT 0,      -- æ–°å¢
    role TEXT DEFAULT 'user',         -- æ–°å¢
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

### UserLimitè¡¨ (æ–°å»º)
```sql
CREATE TABLE user_limits (
    id TEXT PRIMARY KEY,
    user_id TEXT UNIQUE NOT NULL,
    max_requests_per_day INTEGER DEFAULT 1000,
    max_tokens_per_day INTEGER DEFAULT 100000,
    max_tokens_per_month INTEGER DEFAULT 1000000,
    is_limited BOOLEAN DEFAULT 0,
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
);
```

---

## ğŸš€ APIç«¯ç‚¹

### Admin API (`/api/admin/*`)

#### `GET /api/admin/users`
è·å–æ‰€æœ‰ç”¨æˆ·åŠå…¶ä½¿ç”¨ç»Ÿè®¡
- **æƒé™**: Admin only
- **è¿”å›**: `UserWithLimit[]`

#### `GET /api/admin/stats`
è·å–å¹³å°æ•´ä½“ç»Ÿè®¡
- **æƒé™**: Admin only
- **è¿”å›**: `PlatformStats`

#### `GET /api/admin/user/{user_id}/usage?days=30`
è·å–æŒ‡å®šç”¨æˆ·è¯¦ç»†ä½¿ç”¨è®°å½•
- **æƒé™**: Admin only
- **è¿”å›**: ç”¨æˆ·ä½¿ç”¨è¯¦æƒ…ã€æŒ‰æ¨¡å‹ç»Ÿè®¡ã€æŒ‰ä»»åŠ¡ç»Ÿè®¡ã€æœ€è¿‘æ—¥å¿—

#### `PUT /api/admin/user/{user_id}/limit`
æ›´æ–°ç”¨æˆ·é…é¢é™åˆ¶
- **æƒé™**: Admin only
- **Body**: `UpdateUserLimitRequest`

#### `PUT /api/admin/user/{user_id}/status`
å¯ç”¨/ç¦ç”¨ç”¨æˆ·
- **æƒé™**: Admin only
- **Body**: `{ "is_active": boolean }`

#### `DELETE /api/admin/user/{user_id}`
åˆ é™¤ç”¨æˆ·ï¼ˆä¸èƒ½åˆ é™¤adminï¼‰
- **æƒé™**: Admin only

---

## ğŸ–¥ï¸ å‰ç«¯ç»„ä»¶

### AdminPanel.tsx
**è·¯å¾„**: `client/src/components/AdminPanel.tsx`

#### åŠŸèƒ½åŒºåŸŸ

1. **å¹³å°ç»Ÿè®¡å¡ç‰‡**:
   - 6ä¸ªå½©è‰²å¡ç‰‡æ˜¾ç¤ºå…³é”®æŒ‡æ ‡
   - å®æ—¶æ•°æ®ï¼Œè‡ªåŠ¨æ ¼å¼åŒ–ï¼ˆKã€Må•ä½ï¼‰

2. **ç”¨æˆ·ç®¡ç†è¡¨æ ¼**:
   - æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·è¯¦ç»†ä¿¡æ¯
   - å®æ—¶ä½¿ç”¨æ•°æ®ï¼ˆæ€»è®¡+ä»Šæ—¥ï¼‰
   - é…é¢çŠ¶æ€æ ‡è¯†
   - æ“ä½œæŒ‰é’®ï¼ˆç¼–è¾‘é™åˆ¶ã€å¯ç”¨/ç¦ç”¨ã€åˆ é™¤ï¼‰

3. **é…é¢ç¼–è¾‘æ¨¡æ€æ¡†**:
   - ç¾è§‚çš„å¼¹çª—ç•Œé¢
   - å®æ—¶è¡¨å•éªŒè¯
   - å¼€å…³æ§åˆ¶é™åˆ¶å¯ç”¨
   - ä¿å­˜/å–æ¶ˆæŒ‰é’®

#### UIç‰¹ç‚¹
- ğŸ¨ ç°ä»£åŒ–è®¾è®¡ï¼Œå½©è‰²ä¸»é¢˜
- ğŸ“Š ç›´è§‚çš„æ•°æ®å±•ç¤º
- ğŸ”„ å®æ—¶æ›´æ–°
- âš¡ å“åº”å¼å¸ƒå±€
- ğŸ¯ æ¸…æ™°çš„æ“ä½œåé¦ˆ

---

## ğŸ”‘ Adminè´¦æˆ·ä¿¡æ¯

### é»˜è®¤è´¦æˆ·
```
Username: admin
Email: admin@cloudflare.com
Password: admin123
API Key: cb_8ec574bf46f4456d80e9f4d5e2ea29c3
Role: admin
Limits: Unlimited (0/0/0)
```

âš ï¸ **é‡è¦**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¯·ç«‹å³ä¿®æ”¹å¯†ç ï¼

---

## ğŸ“ ä½¿ç”¨æŒ‡å—

### 1. å¯åŠ¨å¹³å°
```bash
# åç«¯
cd /Users/chunyiyang/I3/api-billing-platform/server
source venv/bin/activate
python main.py

# å‰ç«¯
cd /Users/chunyiyang/I3/api-billing-platform/client
npm run dev
```

### 2. Adminç™»å½•
1. è®¿é—® http://localhost:5173
2. ä½¿ç”¨adminè´¦æˆ·ç™»å½•:
   - ç”¨æˆ·å: `admin`
   - å¯†ç : `admin123`
3. ç™»å½•åä¼šçœ‹åˆ°é¢å¤–çš„ **ğŸ”§ Admin** æ ‡ç­¾é¡µ

### 3. ç®¡ç†ç”¨æˆ·
1. ç‚¹å‡» **ğŸ”§ Admin** æ ‡ç­¾é¡µ
2. æŸ¥çœ‹å¹³å°ç»Ÿè®¡å’Œæ‰€æœ‰ç”¨æˆ·
3. å¯¹ä»»æ„ç”¨æˆ·æ‰§è¡Œæ“ä½œ:
   - **Edit Limits**: è®¾ç½®é…é¢é™åˆ¶
   - **Enable/Disable**: å¯ç”¨æˆ–ç¦ç”¨è´¦æˆ·
   - **Delete**: åˆ é™¤ç”¨æˆ·ï¼ˆä¸èƒ½åˆ é™¤adminï¼‰

### 4. è®¾ç½®é…é¢
1. ç‚¹å‡»ç”¨æˆ·çš„ **Edit Limits** æŒ‰é’®
2. å‹¾é€‰ **Enable Limits** å¤é€‰æ¡†
3. è®¾ç½®æ¯æ—¥/æ¯æœˆé™åˆ¶:
   - 0 = æ— é™åˆ¶
   - > 0 = å…·ä½“æ•°å€¼é™åˆ¶
4. ç‚¹å‡» **Save Changes**

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### æµ‹è¯•1: Adminç™»å½•å’Œç•Œé¢
1. âœ… ä½¿ç”¨adminè´¦æˆ·ç™»å½•
2. âœ… éªŒè¯å¯ä»¥çœ‹åˆ°"ğŸ”§ Admin"æ ‡ç­¾é¡µ
3. âœ… ç‚¹å‡»æ ‡ç­¾é¡µï¼ŒåŠ è½½adminé¢æ¿
4. âœ… ç¡®è®¤æ˜¾ç¤ºå¹³å°ç»Ÿè®¡æ•°æ®

### æµ‹è¯•2: ç”¨æˆ·ç®¡ç†
1. âœ… æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
2. âœ… æŸ¥çœ‹ç”¨æˆ·ä½¿ç”¨ç»Ÿè®¡
3. âœ… ç¦ç”¨/å¯ç”¨æ™®é€šç”¨æˆ·
4. âœ… å°è¯•åˆ é™¤adminï¼ˆåº”è¢«æ‹’ç»ï¼‰
5. âœ… åˆ é™¤æ™®é€šç”¨æˆ·

### æµ‹è¯•3: é…é¢ç®¡ç†
1. âœ… ä¸ºç”¨æˆ·è®¾ç½®é…é¢é™åˆ¶
2. âœ… éªŒè¯é™åˆ¶ä¿å­˜æˆåŠŸ
3. âœ… ä¿®æ”¹å·²æœ‰é™åˆ¶
4. âœ… ç¦ç”¨é™åˆ¶ï¼ˆis_limited = falseï¼‰

### æµ‹è¯•4: æƒé™éªŒè¯
1. âœ… æ™®é€šç”¨æˆ·ç™»å½•åçœ‹ä¸åˆ°Adminæ ‡ç­¾é¡µ
2. âœ… æ™®é€šç”¨æˆ·å°è¯•è®¿é—®admin APIè¢«æ‹’ç»ï¼ˆ403ï¼‰
3. âœ… Adminå¯æ­£å¸¸è®¿é—®æ‰€æœ‰adminåŠŸèƒ½

---

## ğŸ“ æ–°å¢/ä¿®æ”¹æ–‡ä»¶

### Backend
- âœ… `server/models.py` - æ›´æ–°Useræ¨¡å‹ï¼Œæ·»åŠ UserLimitæ¨¡å‹
- âœ… `server/database.py` - å¯¼å…¥UserLimitæ¨¡å‹
- âœ… `server/middleware.py` - æ–°å»ºï¼šadminæƒé™éªŒè¯ä¸­é—´ä»¶
- âœ… `server/routers/admin_router.py` - æ–°å»ºï¼šadminè·¯ç”±
- âœ… `server/main.py` - æ³¨å†Œadmin_router
- âœ… `server/migrate_to_admin.py` - æ–°å»ºï¼šæ•°æ®åº“è¿ç§»è„šæœ¬
- âœ… `server/create_admin.py` - æ–°å»ºï¼šåˆ›å»ºadminè´¦æˆ·è„šæœ¬
- âœ… `server/cloudflare_client_simple.py` - ç§»é™¤2ä¸ªSDæ¨¡å‹

### Frontend
- âœ… `client/src/components/AdminPanel.tsx` - æ–°å»ºï¼šAdminç®¡ç†é¢æ¿
- âœ… `client/src/pages/Dashboard.tsx` - æ·»åŠ Adminæ ‡ç­¾é¡µ
- âœ… `client/src/api.ts` - æ·»åŠ Admin APIæ¥å£å’Œç±»å‹å®šä¹‰

---

## ğŸŠ å®Œæˆæ€»ç»“

### æ ¸å¿ƒæˆå°±
1. âœ… **ç®€åŒ–æ¨¡å‹åˆ—è¡¨**: ä»10ä¸ªå‡å°‘åˆ°5ä¸ªç²¾é€‰å¯ç”¨æ¨¡å‹
2. âœ… **å®Œæ•´Adminç³»ç»Ÿ**: 
   - æƒé™ç®¡ç†
   - ç”¨æˆ·ç®¡ç†
   - é…é¢æ§åˆ¶
   - å¹³å°ç›‘æ§
3. âœ… **ç¾è§‚çš„UI**: ç°ä»£åŒ–ã€ç›´è§‚ã€å“åº”å¼çš„ç®¡ç†ç•Œé¢
4. âœ… **å®‰å…¨æ€§**: å®Œæ•´çš„æƒé™éªŒè¯å’Œè§’è‰²æ§åˆ¶
5. âœ… **å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„ç®¡ç†åŠŸèƒ½

### æŠ€æœ¯äº®ç‚¹
- ğŸ” åŸºäºJWTçš„æƒé™éªŒè¯
- ğŸ“Š å®æ—¶ç»Ÿè®¡å’Œç›‘æ§
- ğŸ¨ ä¼˜é›…çš„å‰ç«¯è®¾è®¡
- âš¡ å¿«é€Ÿçš„APIå“åº”
- ğŸ—„ï¸ è§„èŒƒçš„æ•°æ®åº“è®¾è®¡
- ğŸ”„ å®Œæ•´çš„CRUDæ“ä½œ

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### å¯é€‰å¢å¼ºåŠŸèƒ½
1. **é…é¢æ‰§è¡Œ**: åœ¨AIè¯·æ±‚ä¸­å®é™…æ£€æŸ¥å’Œæ‰§è¡Œé…é¢é™åˆ¶
2. **ä½¿ç”¨è¶‹åŠ¿å›¾**: æ·»åŠ Chart.jsæ˜¾ç¤ºä½¿ç”¨è¶‹åŠ¿
3. **ç”¨æˆ·è¯¦æƒ…é¡µ**: ç‚¹å‡»ç”¨æˆ·æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯å’Œå®Œæ•´æ—¥å¿—
4. **æ‰¹é‡æ“ä½œ**: æ‰¹é‡è®¾ç½®é™åˆ¶ã€æ‰¹é‡å¯ç”¨/ç¦ç”¨
5. **å¯¼å‡ºåŠŸèƒ½**: å¯¼å‡ºç”¨æˆ·åˆ—è¡¨å’Œä½¿ç”¨æŠ¥å‘Šä¸ºCSV
6. **é‚®ä»¶é€šçŸ¥**: å½“ç”¨æˆ·è¾¾åˆ°é…é¢æ—¶å‘é€é‚®ä»¶
7. **å®¡è®¡æ—¥å¿—**: è®°å½•æ‰€æœ‰adminæ“ä½œ

---

## ğŸ“ ä½¿ç”¨æ”¯æŒ

### Adminè´¦æˆ·
- ç”¨æˆ·å: `admin`
- å¯†ç : `admin123`
- é‚®ç®±: `admin@cloudflare.com`

### æœåŠ¡å™¨
- åç«¯: http://localhost:8000
- å‰ç«¯: http://localhost:5173
- APIæ–‡æ¡£: http://localhost:8000/docs

### åˆ›å»ºæ–°Admin
```bash
cd /Users/chunyiyang/I3/api-billing-platform/server
source venv/bin/activate
python create_admin.py <username> <email> <password>
```

---

**ğŸ‰ æ‰€æœ‰åŠŸèƒ½å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡ï¼å¹³å°ç°åœ¨å…·å¤‡å®Œæ•´çš„ç®¡ç†å‘˜åŠŸèƒ½ï¼**


