# ğŸš€ GCP éƒ¨ç½²å¿«é€ŸæŒ‡å—

**3æ­¥å®Œæˆéƒ¨ç½²** - ä»…éœ€ 10-15 åˆ†é’Ÿ

---

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

- **GCPè´¦å·**: bob.yang@intelligencecubed.com âœ…
- **é¡¹ç›®æ–‡ä»¶**: åœ¨ä½ çš„æœ¬åœ° `/Users/chunyiyang/I3/api-billing-platform` âœ…

---

## ğŸ¯ éƒ¨ç½²æ­¥éª¤

### ç¬¬1æ­¥ï¼šåˆ›å»º VM (3åˆ†é’Ÿ)

1. **ç™»å½• GCP**: https://console.cloud.google.com
2. **è¿›å…¥ Compute Engine â†’ VM å®ä¾‹**
3. **ç‚¹å‡»"åˆ›å»ºå®ä¾‹"**ï¼Œä½¿ç”¨ä»¥ä¸‹é…ç½®ï¼š

```
åç§°: cloudflare-api
åŒºåŸŸ: us-west1 (æˆ–ä»»æ„)
æœºå™¨ç±»å‹: e2-medium (2 vCPU, 4GB)
å¯åŠ¨ç£ç›˜: Ubuntu 22.04 LTS, 20GB
é˜²ç«å¢™: âœ… å…è®¸ HTTP å’Œ HTTPS æµé‡
```

4. **ç‚¹å‡»"åˆ›å»º"**ï¼Œç­‰å¾…1-2åˆ†é’Ÿ

### ç¬¬2æ­¥ï¼šé…ç½®é˜²ç«å¢™ (2åˆ†é’Ÿ)

1. **å·¦ä¾§èœå• â†’ VPC ç½‘ç»œ â†’ é˜²ç«å¢™**
2. **åˆ›å»ºä¸¤ä¸ªé˜²ç«å¢™è§„åˆ™**ï¼š

**è§„åˆ™1** - å…è®¸åç«¯ (ç«¯å£ 8000):
```
åç§°: allow-backend-8000
ç›®æ ‡: ç½‘ç»œä¸­çš„æ‰€æœ‰å®ä¾‹
æ¥æº IPv4: 0.0.0.0/0
åè®®å’Œç«¯å£: tcp:8000
```

**è§„åˆ™2** - å…è®¸å‰ç«¯ (ç«¯å£ 5173):
```
åç§°: allow-frontend-5173  
ç›®æ ‡: ç½‘ç»œä¸­çš„æ‰€æœ‰å®ä¾‹
æ¥æº IPv4: 0.0.0.0/0
åè®®å’Œç«¯å£: tcp:5173
```

### ç¬¬3æ­¥ï¼šéƒ¨ç½²åº”ç”¨ (8åˆ†é’Ÿ)

#### 3.1 ä¸Šä¼ é¡¹ç›®æ–‡ä»¶

**åœ¨ä½ çš„æœ¬åœ° Mac ç»ˆç«¯**è¿è¡Œï¼š

```bash
# å®‰è£… gcloud CLI (å¦‚æœè¿˜æ²¡æœ‰)
# è®¿é—®: https://cloud.google.com/sdk/docs/install
# æˆ–ä½¿ç”¨ Homebrew: brew install --cask google-cloud-sdk

# è®¤è¯ç™»å½•
gcloud auth login

# è®¾ç½®ä½ çš„é¡¹ç›®ID (æ›¿æ¢ä¸ºä½ çš„å®é™…é¡¹ç›®ID)
gcloud config set project YOUR_PROJECT_ID

# ä¸Šä¼ é¡¹ç›®åˆ° VM
cd /Users/chunyiyang/I3
gcloud compute scp --recurse api-billing-platform cloudflare-api:~ --zone=us-west1-a

# è¿æ¥åˆ° VM
gcloud compute ssh cloudflare-api --zone=us-west1-a
```

#### 3.2 è¿è¡Œéƒ¨ç½²è„šæœ¬

**åœ¨ VM çš„ SSH ç»ˆç«¯**è¿è¡Œï¼š

```bash
cd ~/api-billing-platform
chmod +x deploy-simple.sh
./deploy-simple.sh
```

ç­‰å¾… 5-8 åˆ†é’Ÿï¼Œè„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- âœ… å®‰è£… Python 3.11
- âœ… å®‰è£… Node.js 18
- âœ… å®‰è£…æ‰€æœ‰ä¾èµ–
- âœ… åˆå§‹åŒ–æ•°æ®åº“
- âœ… åˆ›å»ºç®¡ç†å‘˜è´¦å·
- âœ… æ„å»ºå‰ç«¯

#### 3.3 å¯åŠ¨æœåŠ¡

```bash
./start.sh
```

å±å¹•ä¼šæ˜¾ç¤ºï¼š
```
âœ… åç«¯å·²å¯åŠ¨
âœ… å‰ç«¯å·²å¯åŠ¨

ğŸŒ è®¿é—®åœ°å€:
   å‰ç«¯: http://YOUR_VM_IP:5173
   åç«¯: http://YOUR_VM_IP:8000
   APIæ–‡æ¡£: http://YOUR_VM_IP:8000/docs

ğŸ‘¤ ç®¡ç†å‘˜è´¦å·:
   ç”¨æˆ·å: admin
   å¯†ç : admin123
```

---

## ğŸ‰ å®Œæˆï¼

**è®¿é—®ä½ çš„åº”ç”¨**: http://YOUR_VM_IP:5173

**ç®¡ç†å‘˜ç™»å½•**:
- ç”¨æˆ·å: `admin`
- å¯†ç : `admin123`

---

## ğŸ”§ å¸¸ç”¨ç®¡ç†å‘½ä»¤

```bash
# åœ¨ VM ä¸Šçš„ ~/api-billing-platform ç›®å½•

./start.sh       # å¯åŠ¨æœåŠ¡
./stop.sh        # åœæ­¢æœåŠ¡
./restart.sh     # é‡å¯æœåŠ¡
./status.sh      # æŸ¥çœ‹çŠ¶æ€
./logs.sh        # æŸ¥çœ‹æ—¥å¿—
```

---

## â“ æ‰¾ä¸åˆ° VM IPï¼Ÿ

**æ–¹æ³•1** - GCP Console:
- VM å®ä¾‹é¡µé¢ â†’ æ‰¾åˆ° "å¤–éƒ¨ IP" åˆ—

**æ–¹æ³•2** - åœ¨ VM ä¸Šè¿è¡Œ:
```bash
curl ifconfig.me
```

---

## ğŸ†˜ é‡åˆ°é—®é¢˜ï¼Ÿ

### é—®é¢˜1: æ— æ³•è®¿é—®å‰ç«¯/åç«¯

**æ£€æŸ¥é˜²ç«å¢™è§„åˆ™æ˜¯å¦åˆ›å»º**:
```bash
gcloud compute firewall-rules list | grep -E 'allow-(backend|frontend)'
```

å¦‚æœæ²¡æœ‰ï¼Œåœ¨ VM ä¸Šè¿è¡Œ:
```bash
sudo ufw allow 8000
sudo ufw allow 5173
```

### é—®é¢˜2: æœåŠ¡æœªå¯åŠ¨

**æŸ¥çœ‹çŠ¶æ€**:
```bash
./status.sh
```

**æŸ¥çœ‹æ—¥å¿—**:
```bash
./logs.sh
```

### é—®é¢˜3: ç«¯å£è¢«å ç”¨

**æ¸…ç†è¿›ç¨‹**:
```bash
./stop.sh
sudo pkill -f python
sudo pkill -f node
./start.sh
```

---

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**: `./logs.sh`
2. **æ£€æŸ¥çŠ¶æ€**: `./status.sh`  
3. **é‡å¯æœåŠ¡**: `./restart.sh`

æä¾›ä»¥ä¸‹ä¿¡æ¯æœ‰åŠ©äºå¿«é€Ÿè§£å†³ï¼š
- VM å¤–éƒ¨ IP
- é”™è¯¯æ—¥å¿— (`./logs.sh`)
- æœåŠ¡çŠ¶æ€ (`./status.sh`)

---

## ğŸ” å®‰å…¨å»ºè®®

ä¸Šçº¿åå»ºè®®ï¼š

1. **ä¿®æ”¹ç®¡ç†å‘˜å¯†ç **
2. **é™åˆ¶é˜²ç«å¢™æºIP**ï¼ˆå¦‚æœåªæœ‰ç‰¹å®šç”¨æˆ·è®¿é—®ï¼‰
3. **é…ç½® HTTPS**ï¼ˆå¦‚æœæœ‰åŸŸåï¼‰
4. **å®šæœŸå¤‡ä»½æ•°æ®åº“**: `cp server/app.db server/app.db.backup`

---

## ğŸ“Š ç›‘æ§ä½¿ç”¨æƒ…å†µ

- **Adminé¢æ¿**: ç™»å½•åç‚¹å‡» "ğŸ”§ Admin" æ ‡ç­¾
- **Usageé¢æ¿**: æŸ¥çœ‹ä¸ªäººä½¿ç”¨ç»Ÿè®¡
- **åç«¯æ—¥å¿—**: `tail -f server/backend.log`

---

## âš¡ æ€§èƒ½ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

### ä½¿ç”¨æ›´å¤§çš„ VM
```
æœºå™¨ç±»å‹: e2-standard-2 (2 vCPU, 8GB) æˆ–æ›´é«˜
```

### è®¾ç½®å¼€æœºè‡ªå¯åŠ¨
```bash
# åœ¨ VM ä¸Šè¿è¡Œ
sudo nano /etc/rc.local
```

æ·»åŠ ï¼š
```bash
#!/bin/bash
sleep 10
cd /home/YOUR_USERNAME/api-billing-platform && ./start.sh
```

```bash
sudo chmod +x /etc/rc.local
```

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼** ğŸš€

